			


 
目录
1	项目概要	1
1.1	项目名称	1
1.2	项目简介与要求	1
1.3	功能描述	1
1.4	项目目标	2
1.5	开发环境	2
1.6	关键技术	2
2	系统结构图	3
2.1	系统结构图	3
2.2	模拟示意图	3
2.3	PC侧GUI 控制示意图	7
3	动作要求	9
3.1	远程控制	9
3.2	键盘/触摸屏动作	9
3.3	AD动作	10
3.4	音频动作	11
4	显示及录入要求	11
4.1	主界面显示	11
4.2	患者显示	11
4.3	医生简介	11
4.4	楼宇位置平面图	11
4.5	血糖/时间显示	11
4.6	血压的显示	12
4.7	显示/录入患者信息	12
4.8	显示/录入医生简介	12
4.9	计算器	12
4.10	拼音输入法	12
5	通信协议	12
5.1	UDP协议	12
5.2	数据定义	13
6	项目设计	13
6.1	设计框架	13
6.2	模块要求	14
7	数据结构	15
8	设计要•求	15
 

1	项目概要

1.1	项目名称

手持医疗终端（基于2410硬件平台，uCOSII操作系统）。

1.2	项目简介与要求

随着科学技术的进步和人民生活水平的日益提高，医疗保健问题成了社会广泛关注的焦点。医疗保健系统在这种社会大环境下应运而生，它结合了信息和医疗技术，以计算机技术为支撑，使人们在更大的享受医院专业级的监护。该系统设计主要包括手持医疗终端和PC机医疗监护端两部分，其中医疗手持终端的实现是我们的中断，工作过程：通过血压计、血糖计等数字测量仪器采集数据，通过串口或USB口送入医疗手持终端（本项目中应用AD模拟血压、血糖），然后该终端对数据整体打包通过网络传送到PC机医疗监护端，并且可以完成患者信息查询、存档，查询医生信息，医院楼宇布局图等，实现基本的医疗数据测量，以及与医院的信息化通信，提高检查效率，为患者节约时间。
该终端医护人员也可使用，可查询患者信息及治疗情况、用药信息。
 

1.3	功能描述

医疗手持终端功能：
1） 相关医护人员通过按键或触摸屏的输入查看患者情况，通过lcd显示；
2） 就诊患者及家属可以借助于该终端查看医院楼房位置图或主治医生简介，医生简介实现存储在电子硬盘中，通过yaffs读出，医院楼房位置图通过GUI描绘；
3）在出现紧急事故时可以通过音频提示；
4）PC上位机界面进行信息录入及信息更新；
5）lcd屏可显示当时的北京时间（RTC）；
6）lcd屏上有相应的血糖、血压显示，并且血糖、血压通过AD0,AD1模拟，实时显示，并可将数据记录到患者信息，传至PC机端存档。
7）可以实现基本计算功能。

1.4	项目目标

1）掌握嵌入式开发流程；
2）了解嵌入式开发必备知识；
3）掌握uC-OS II操作系统；
4）熟练应用C语言，学习嵌入式调试手法；
5）熟练使用C++语言；
6）培养快速学习新的知识，并在项目中使用的能力。

1.5	开发环境

调试环境：ADS1.2，VC++6.0
编译环境：ARMCC
硬件环境：ARM9内核s3c2410硬件平台
字模转换：字模软件
位图转换：位图转换工具（用于照片的提供）
存储器容量：SDRAM 64MB, FLASH ROM 64MB。


1.6	关键技术

C语言编程
C++语言编程
uC-OS II操作系统
GUI图形设计
648*480LCD液晶屏显示
触摸屏
17键小键盘
模数转换器
Ethernet网卡（UDP通信）
UcGUI



2	系统结构图

2.1	系统结构图
 

2.2	模拟示意图

界面可以自行设计，不作具体要求，以下仅为参考：
主界面可自行设计（参考如下）。
 
1）患者信息
 
点击“存档”信息发送至PC机医疗监护端，完成患者信息存档。

2）医生简介
 
点击“存档”信息发送至PC机医疗监护端，完成医生简介存档。

3）楼宇平面图

 


4）血糖计
 
点击“存档”会跳到患者信息界面。
5）计算器
 
6）血压计
 
点击“存档”会跳到患者信息界面。

2.3	PC侧GUI 控制示意图
 
1）患者信息
 
2）医生简介
 
3）楼宇平面图
 


3	动作要求

3.1	远程控制
初期上电
 
1). 当连接失败，显示CONNECT ERROR信息。
2). 当Rsp是NG时，显示GUI ERROR
3). 当Rsp是Busy时，每隔500ms再次Retry，Retry三次后，以NG处理。
4). 当Rsp 在500ms内没有回复时，同Busy处理。

3.2	键盘/触摸屏动作

LCD显示的相关信息可以通过主界面的子项进行选择，也可以通过消息框的下拉选择进行选择。
通过按键/触摸屏可改变LCD屏的显示信息，可使用列表框列出患者姓名及医生姓名，然后通过enter键显示该信息，也可通过按键/触摸屏实现功能选择。
 

3.3	AD动作

1） AD0控制血糖变化，空腹血糖值正常指数为3.9-6.1mmol/L，低于临界值蜂鸣器响2声提醒患者，高于临界值蜂鸣器连续响20s提醒患者。
2） AD1控制血压变化，高压不超过140毫米汞柱，低压不超过90毫米汞柱，低于临界值蜂鸣器响2声提醒患者，高于临界值蜂鸣器连续响20s提醒患者。
 

3.4	音频动作
当有紧急情况时，可通过该终端发出紧急通报。


4	显示及录入要求	

4.1	主界面显示   
提供患者信息，医生简介，楼宇平面图，血糖计，计算器，血压计的显示。

4.2	患者显示
可用列表框的下拉框进行不同患者情况信息的选择。
同时带有返回功能，可返回主界面，也可返回到列表框。

4.3	医生简介
可用列表框的下拉框进行不同医生情况信息的选择（应该是提供当日在岗的医生名单）。
接收enter键后，进行医生信息显示，同时带有返回功能，可返回主界面。

4.4	楼宇位置平面图
用GUI描绘医院楼房的平面图，为患者做向导。

4.5	血糖/时间显示
显示当前的血糖测量数据，并通过PC机获取当前时间，显示出来。
4.6	血压的显示
显示当前的血压测量数据。
注：如要显示其它内容，可在显示模块自行设计。

4.7	显示/录入患者信息
通过触摸屏输入患者姓名、住址、住院、病史等信息，为医生的诊断提供必要的参考。

4.8	显示/录入医生简介
医护人员通过触摸屏输入医生简介、所属科室及从业经验等，为患者的选择主治医生提
供必要的参考。

4.9	计算器
支持任意数据的加减乘除运算，包括浮点数。

4.10	拼音输入法
为了支持信息的录入及汉字的书写，方便医护人员的使用。


5	通信协议
5.1	UDP协议
本处采用UDP协议作为PC侧GUI和MHHT侧通信使用，数据报设计如下。

Byte	1	2	3	4	5	6	7~200
内容	Info长度	CMD类型	接收元	发送元	CMD ID	CheckSum	Info

1.	长度
首部固定6字节，CMD ID不同，Info长度看第一字节。
2.	CMD 类型

CMD Type:  1Byte
PC与MHHT之间的通信主要有三种类型。
01   Req   ：Request
02   Rsp   ：Response
03   Ctr    ：Control
3.	接收元  1Byte
接收的目的地   
F0  ：MHHT
F1  ：PC
4.	发送元  1Byte
发送的源
F0  ：MHHT
F1  ：PC
5.	ID   1Byte
每一个类型中每一个CMD都有一个自己的能够标示自己的ID.
列出所有的CMD，并加标示。
6.	Checksum    1Byte
该CMD的CheckSum.
CheckSum的计算方法：
前5字节加后的值。
7.	Info  7~200Byte
Information信息, 附带的其他信息，比如Rsp的信息（OK ：1 NG ：2	BUSY ：0xFC）。

5.2	数据定义
1.Response定义
Byte2 ：02 
Byte5 ：请求的CMD ID
Byte6 ：OK ：1
		NG ：2
		BUSY ：0xFC
2.CMD定义
NO	CMD	Byte5 Code 	Byte7~200
1	Ctr patient	0x01	info
2	Ctr doc	0x02	info
3	Ctr inquire patient	0x03	0
4	Ctr inquire doc	0x04	0
5	Ctr answer patient	0x05	info
6	Ctr answer doc	0x06	info
7	Ctr inquire time	0x07	0
8	Ctr answer time	0x08	info
9	Ctr Tinfo	0x09	info
10	Ctr Hinfo	0x0A	info


6	项目设计

6.1	设计框架

 
6.2	模块要求

模块名称	功能要求	功能说明
main	系统管理模块	uC-OSII管理
		调用系统初始化、网络初始化、触摸屏初始化、LCD初始化
		创建各个任务、启动任务
Receive_Task 	从上位机接收信息模块	接收来自PC机的信息
Send_Task	发送信息模块	发送相关信息给PC机
Lcd_Task	显示任务模块	分析图形LCD设备驱动
		分析GUI接口函数
		主界面的显示
		血糖、日历时间的显示
		血压值显示
		计算器显示
		楼宇位置平面图显示
		患者信息显示
		医生简介
TCHSCR_Task	触摸屏任务	得到触摸的范围，确定要执行的功能
Key_Task	按键任务	得到按键值，确定要执行的功能
AD_Task	捕捉AD值	通过AD值的变化进行血糖、血压的变化
Sound_Task	音频（IIS接口的DMA方式）	当有紧急情况发生时，报警提醒
Mysql_Task	数据库任务	数据存储、查询


7	数据结构

举例如下：
typedef struct{
	U32 year;
	U32 month;
	U32 day;
	U32 date;
	U32 hour;
	U32 minute;
	U32 second;
}structTime, *PstructTime;

typedef struct{
	U32 year;
	U32 month;
	U32 day;
}structDate, *PstructDate;

typedef struct{
	U32 hour;
	U32 minute;
	U32 second;
}structClock, *PstructClock;


8	设计要求	

1）	 函数接口明确清晰
高内聚，低耦合，定义书规范。

2）	 编码规范
参考C编码规范进行函数，变量，文件定义。
参考C++编码规范进行函数，变量，文件定义。

